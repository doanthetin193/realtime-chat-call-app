<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin: 10px 0; }
        input[type="text"] { width: 70%; padding: 8px; }
        button { padding: 8px 15px; margin: 5px; }
        .status { padding: 5px; margin: 5px 0; border-radius: 3px; }
        .connected { background-color: #d4edda; color: #155724; }
        .disconnected { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Socket.IO Test Client</h1>
        
        <div id="status" class="status disconnected">Disconnected</div>
        
        <div>
            <h3>Authentication</h3>
            <input type="text" id="token" placeholder="JWT Token (optional for test)" style="width: 80%;">
            <button onclick="connect()">Connect</button>
            <button onclick="disconnect()">Disconnect</button>
        </div>

        <div>
            <h3>Send Message</h3>
            <input type="text" id="conversationId" placeholder="Conversation ID">
            <input type="text" id="messageText" placeholder="Message content">
            <button onclick="sendMessage()">Send Message</button>
        </div>

        <div>
            <h3>Online Users</h3>
            <div id="onlineUsers"></div>
        </div>

        <div>
            <h3>Messages</h3>
            <div id="messages" class="messages"></div>
        </div>

        <div>
            <button onclick="clearMessages()">Clear Messages</button>
        </div>
    </div>

    <script>
        let socket = null;

        function connect() {
            const token = document.getElementById('token').value;
            
            // Connect to Socket.IO server
            socket = io('http://localhost:5000', {
                auth: {
                    token: token || 'test-token' // Use test token if none provided
                }
            });

            // Connection events
            socket.on('connect', () => {
                document.getElementById('status').className = 'status connected';
                document.getElementById('status').textContent = 'Connected - ID: ' + socket.id;
                addMessage('System', 'Connected to server');
            });

            socket.on('disconnect', () => {
                document.getElementById('status').className = 'status disconnected';
                document.getElementById('status').textContent = 'Disconnected';
                addMessage('System', 'Disconnected from server');
            });

            socket.on('connect_error', (error) => {
                addMessage('Error', 'Connection error: ' + error.message);
            });

            // Message events
            socket.on('receiveMessage', (data) => {
                addMessage('Received', JSON.stringify(data, null, 2));
            });

            socket.on('messageUpdate', (data) => {
                addMessage('Message Update', JSON.stringify(data, null, 2));
            });

            // Typing events
            socket.on('userTyping', (data) => {
                addMessage('Typing', `${data.username} is typing...`);
            });

            socket.on('userStoppedTyping', (data) => {
                addMessage('Stopped Typing', `${data.username} stopped typing`);
            });

            // Online users
            socket.on('onlineUsers', (users) => {
                document.getElementById('onlineUsers').innerHTML = 
                    '<strong>Online:</strong> ' + JSON.stringify(users, null, 2);
            });

            socket.on('userOnline', (data) => {
                addMessage('User Online', JSON.stringify(data, null, 2));
            });

            socket.on('userOffline', (data) => {
                addMessage('User Offline', JSON.stringify(data, null, 2));
            });

            // Video call events
            socket.on('incomingCall', (data) => {
                addMessage('Incoming Call', JSON.stringify(data, null, 2));
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }

        function sendMessage() {
            const conversationId = document.getElementById('conversationId').value;
            const content = document.getElementById('messageText').value;

            if (!socket) {
                alert('Please connect first');
                return;
            }

            if (!conversationId || !content) {
                alert('Please enter conversation ID and message');
                return;
            }

            const messageData = {
                conversationId: conversationId,
                content: content,
                type: 'text'
            };

            socket.emit('sendMessage', messageData);
            addMessage('Sent', JSON.stringify(messageData, null, 2));
            
            // Clear input
            document.getElementById('messageText').value = '';
        }

        function addMessage(type, message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `
                <strong>[${new Date().toLocaleTimeString()}] ${type}:</strong><br>
                <pre style="background: #f5f5f5; padding: 5px; margin: 5px 0;">${message}</pre>
            `;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }

        // Auto-connect on page load
        window.onload = function() {
            addMessage('System', 'Page loaded. Click Connect to start testing Socket.IO');
        };
    </script>
</body>
</html>
